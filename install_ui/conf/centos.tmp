# This file is for running the backup program 
# on a dedicated apache install

# Ports
Listen 80
Listen 443

# Admin email
ServerAdmin root@localhost

# User
User apache
Group apache

# SSL configuration
SSLPassPhraseDialog  builtin
SSLSessionCache         shmcb:/var/cache/mod_ssl/scache(512000)
SSLSessionCacheTimeout  300
SSLMutex default
SSLRandomSeed startup file:/dev/urandom  256
SSLRandomSeed connect builtin
SSLCryptoDevice builtin

# Directory permissions
<Directory />
	Options None
	Order deny,allow
	Deny from all
</Directory>
<Directory ARCHIVE_DIRECTORY>
	Order allow,deny
	Allow from all
</Directory>
<Directory BASE_DIRECTORY/ui/>
	Order allow,deny
	Allow from all
</Directory>
<Directory BASE_DIRECTORY/db/>
	Order allow,deny
	Allow from all
</Directory>
<Directory BASE_DIRECTORY/redirect/>
	Order allow,deny
	Allow from all
</Directory>

# F5 Web UI
DocumentRoot "BASE_DIRECTORY/ui/"
<VirtualHost *:80>
	# Port 80 listener for HTTPS redirects
	DocumentRoot BASE_DIRECTORY/redirect
	
	# Send all requests to default page
	RewriteEngine On
	RewriteRule  ^/. /index.php
</VirtualHost>
<VirtualHost _default_:443>
	SSLEngine on
	SSLProtocol all -SSLv2
	SSLCipherSuite ALL:!ADH:!SSLv2:RC4+RSA:+HIGH:+MEDIUM:+LOW
	
	# SSL Certificates 
	SSLCertificateFile /etc/pki/tls/certs/localhost.crt
	SSLCertificateKeyFile /etc/pki/tls/private/localhost.key

	ErrorLog logs/ssl_error_log
	TransferLog logs/ssl_access_log
	LogLevel warn
	CustomLog logs/ssl_request_log "%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \"%r\" %b"
	
	# Error page is default page
	ErrorDocument 404 /index.php 	
	
   DocumentRoot BASE_DIRECTORY/ui
	
	# Make users browser cache images and css
	<Location /images/>
		Header Set Cache-Control "max-age=86400, public"
	</Location>
	<Location /css/>
		Header Set Cache-Control "max-age=86400, public"
	</Location>
	
	# Deny user access to include folder
	<Location /include/>
		Order allow,deny
		Deny from all
	</Location>
</VirtualHost>

# Turn off Server info
ServerTokens ProductOnly
ServerSignature Off

# PHP settings
<IfModule prefork.c>
  LoadModule php5_module modules/libphp5.so
</IfModule>
<IfModule worker.c>
  LoadModule php5_module modules/libphp5-zts.so
</IfModule>
AddHandler php5-script .php
AddType text/html .php
DirectoryIndex index.php

# Default values
ServerRoot "/etc/httpd"
PidFile run/httpd.pid
Timeout 60
KeepAlive On
MaxKeepAliveRequests 100
KeepAliveTimeout 15
UseCanonicalName Off
HostnameLookups Off
DefaultType None
AddDefaultCharset UTF-8
TypesConfig /etc/mime.types

# Logging configuration
ErrorLog logs/error_log
LogLevel warn
LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
LogFormat "%h %l %u %t \"%r\" %>s %b" common
LogFormat "%{Referer}i -> %U" referer
LogFormat "%{User-agent}i" agent
CustomLog logs/access_log combined

# prefork MPM
<IfModule prefork.c>
StartServers       8
MinSpareServers    5
MaxSpareServers   20
ServerLimit      256
MaxClients       256
MaxRequestsPerChild  4000
</IfModule>

# worker MPM
<IfModule worker.c>
StartServers         4
MaxClients         300
MinSpareThreads     25
MaxSpareThreads     75
ThreadsPerChild     25
MaxRequestsPerChild  0
</IfModule>

<IfModule mod_mime_magic.c>
    MIMEMagicFile conf/magic
</IfModule>

# Dynamic Shared Object (DSO) Support
LoadModule authz_host_module modules/mod_authz_host.so
LoadModule log_config_module modules/mod_log_config.so
LoadModule logio_module modules/mod_logio.so
LoadModule env_module modules/mod_env.so
LoadModule mime_magic_module modules/mod_mime_magic.so
LoadModule expires_module modules/mod_expires.so
LoadModule headers_module modules/mod_headers.so
LoadModule setenvif_module modules/mod_setenvif.so
LoadModule mime_module modules/mod_mime.so
LoadModule vhost_alias_module modules/mod_vhost_alias.so
LoadModule dir_module modules/mod_dir.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule ssl_module modules/mod_ssl.so